<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>IntraChat WebSendMessage</title>
        <meta name="viewport" content="width=device-width">
        <script type="text/javascript" src="CICProtocol2.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            var output;
            
            // não há limite para o número de destinatários da mensagem.
            // para facilitar, é possível enviar uma mensagem para uma unidade inteira, ou um setor inteiro.
            // para isso basta adicionar 'UN:' na frente do código da unidade de destino,
            // ou 'ST:' (ou 'DP:') na frente do nome do setor.
            var Destinos = ['administrador','UN:F08','ST:Administração','tralala'];
            var Texto = 'Teste de envio de mensagem...';
            
            var Servidor = 'localhost';
            var Porta = 55000;
            var Usuario = 'administrador';
            var Senha = 'abc123';
            
            var Enviadas = 0;

            function init() {
                output = document.getElementById("output");
                sendCICMessage();
            }  

            function sendCICMessage() {
                var message = new CICMessageProtocol(Servidor, Porta, Usuario, Senha, Destinos, Texto);
                
                message.onConnect = function() {
                    writeToScreen('CONECTADO');
                };
                
                message.onDisconnect = function() {
                    writeToScreen(Enviadas + ' MENSAGENS ENVIADAS COM SUCESSO');
                    writeToScreen('DESCONECTADO');
                };
                
                message.onError = function(error) {
                    writeToScreen('<span style="color: red;">ERRO:</span> ' + error.data); 
                };
                
                message.onAuthenticationOk = function() {
                    writeToScreen('AUTENTICADO: ' + message.ServerName + ':' + message.ServerID + ' (' + message.ServerVersion + ')');
                };
                
                message.onAuthenticationFailed = function(errornumber, errormessage) {
                    writeToScreen('<span style="color: red;">FALHA DE AUTENTICAÇÃO:</span> (' + errornumber + ') ' + errormessage); 
                };
                
                message.onTextMessageSent = function(packet) {
                    writeToScreen('MENSAGEM ENVIADA. AGUARDANDO RESPOSTA...'); 
                };

                message.onTextMessageOk = function(target, messageid) {
                    Enviadas++;
                    writeToScreen('<span style="color: blue;">OK: ' + target + ' -&gt; ' + messageid +'</span>'); 
                };

                message.onTextMessageFailed = function(target, errormessage) {
                    writeToScreen('<span style="color: red;">FALHA: ' + target + ' -&gt; ' + errormessage + '</span>'); 
                };
            }  

            function writeToScreen(message) { 
                var pre = document.createElement("p"); 
                pre.style.wordWrap = "break-word"; 
                pre.innerHTML = message; 
                output.appendChild(pre); 
            }  

            window.addEventListener("load", init, false);  
        </script>  

        <h2>IntraChat WebSendMessage</h2>  
        <div id="output"></div>
    </body>
</html>
